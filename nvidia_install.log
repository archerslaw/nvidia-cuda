install nvidia driver and cuda begin ......
driver version: 390.46
cuda version: 9.0.176
release:rhel7
version:7
create_nvidia_repo_centos
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Loading mirror speeds from cached hostfile
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.zju.edu.cn
No package epel available.
Error: Nothing to do
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Cleaning repos: base cuda-9-0-local cuda-9-0-local-cublas-performance-update
              : cuda-9-0-local-cublas-performance-update-2 ecs-cuda ecs-driver
              : epel extras nvidia-diag-driver-local-390.46 updates
Cleaning up everything
Maybe you want: rm -rf /var/cache/yum, to also free up space taken by orphaned data from disabled or removed repos
Cleaning up list of fastest mirrors
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Determining fastest mirrors
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.shu.edu.cn
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/repomd.xml: [Errno -1] repomd.xml does not match metalink for epel
Trying other mirror.
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/47b242c470a5c4835462a702bc8a9c512d9431bf65645ceac87fb08f30518eb0-filelists.xml.gz: [Errno 14] HTTP Error 404 - Not Found
Trying other mirror.
To address this issue please refer to the below wiki article 

https://wiki.centos.org/yum-errors

If above article doesn't help to resolve this issue please use https://bugs.centos.org/.

http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/86ecab1b12f971567af493a2fe4501d2d308b2048255b2867dc8bb35741e90c9-prestodelta.xml.gz: [Errno 14] HTTP Error 404 - Not Found
Trying other mirror.
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/b675ce16ab3cd6bed1682738d0bcb67d30c5da192b30f7e2e5d08a89a81d10b1-primary.xml.gz: [Errno 14] HTTP Error 404 - Not Found
Trying other mirror.
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/0d07a598395c5c23beede552b972d26236d714f827d1deee1834c5685eff7be1-other.xml.gz: [Errno 14] HTTP Error 404 - Not Found
Trying other mirror.
http://mirrors.shu.edu.cn/centos/7.5.1804/updates/x86_64/repodata/c9f7215e051be605f956919357111fdf156b05cac2a4b6f4c459640755932600-primary.sqlite.bz2: [Errno 14] curl#7 - "Failed connect to mirrors.shu.edu.cn:80; Connection refused"
Trying other mirror.
Metadata Cache Created
++ uname -r
+ kernel_version=3.10.0-862.9.1.el7.x86_64
+ echo '******exec "uname -r": 3.10.0-862.9.1.el7.x86_64'
******exec "uname -r": 3.10.0-862.9.1.el7.x86_64
+ echo '******exec "rpm -qa | grep kernel-devel | grep 3.10.0-862.9.1.el7.x86_64 | wc -l"'
******exec "rpm -qa | grep kernel-devel | grep 3.10.0-862.9.1.el7.x86_64 | wc -l"
++ rpm -qa
++ grep kernel-devel
++ grep 3.10.0-862.9.1.el7.x86_64
++ wc -l
+ kernel_devel_num=1
+ echo '******kernel_devel_num=1'
******kernel_devel_num=1
+ '[' 1 -eq 0 ']'
******install kernel-devel begin time: 1536563556, end time: 1536563557, use time: 1 s
++ yum list
++ grep nvidia
++ grep driver
++ grep rhel7
++ grep 390.46
++ wc -l
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
+ driver_file_num=1
+ '[' 1 -eq 1 ']'
++ yum list
++ grep nvidia
++ grep driver
++ grep rhel7
++ grep 390.46
++ awk '-F ' '{print $1}'
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
+ driver_file=nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
+ echo '******exec "yum list |grep nvidia | grep driver |grep rhel7 |grep 390.46 | awk -F'\'' '\'' '\''{print $1}'\''":'
******exec "yum list |grep nvidia | grep driver |grep rhel7 |grep 390.46 | awk -F' ' '{print $1}'":
+ echo nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
+ echo '******exec "yum install -y nvidia-diag-driver-local-repo-rhel7-390.46.x86_64" '
******exec "yum install -y nvidia-diag-driver-local-repo-rhel7-390.46.x86_64" 
+ yum install -y nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Loading mirror speeds from cached hostfile
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.shu.edu.cn
Package nvidia-diag-driver-local-repo-rhel7-390.46-1.0-1.x86_64 already installed and latest version
Nothing to do
+ echo '******exec "yum clean all && yum install -y cuda-drivers" '
******exec "yum clean all && yum install -y cuda-drivers" 
+ yum clean all
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Cleaning repos: base cuda-9-0-local cuda-9-0-local-cublas-performance-update
              : cuda-9-0-local-cublas-performance-update-2 ecs-cuda ecs-driver
              : epel extras nvidia-diag-driver-local-390.46 updates
Cleaning up everything
Maybe you want: rm -rf /var/cache/yum, to also free up space taken by orphaned data from disabled or removed repos
Cleaning up list of fastest mirrors
+ yum install -y cuda-drivers
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Determining fastest mirrors
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.shu.edu.cn
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/repomd.xml: [Errno -1] repomd.xml does not match metalink for epel
Trying other mirror.
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/64c9816f25be4ae401c3dfa91321604e8864909e134dbd1b0921d077a9a02543-updateinfo.xml.bz2: [Errno 14] HTTP Error 404 - Not Found
Trying other mirror.
To address this issue please refer to the below wiki article 

https://wiki.centos.org/yum-errors

If above article doesn't help to resolve this issue please use https://bugs.centos.org/.

Package cuda-drivers-390.46-1.x86_64 already installed and latest version
Nothing to do
+ '[' 0 -ne 0 ']'
******install driver begin time: 1536563557, end time: 1536563575,  use time: 18 s
++ date +%s
+ begin_cuda=1536563575
++ yum list
++ grep cuda
++ grep rhel7
++ grep 9.0.176
++ grep -v update
++ wc -l
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
+ cuda_file_num=1
+ '[' 1 -eq 1 ']'
++ yum list
++ grep cuda
++ grep rhel7
++ grep 9.0.176
++ grep -v update
++ awk '-F ' '{print $1}'
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
+ cuda_file=cuda-repo-rhel7-9-0-local.x86_64
+ echo '******exec "yum list --showduplicates |grep cuda |grep rhel7 |grep 9.0.176|grep -v update| awk -F'\'' '\'' '\''{print $1}'\''":'
******exec "yum list --showduplicates |grep cuda |grep rhel7 |grep 9.0.176|grep -v update| awk -F' ' '{print $1}'":
+ echo cuda-repo-rhel7-9-0-local.x86_64
cuda-repo-rhel7-9-0-local.x86_64
+ echo '******exec "yum install -y cuda-repo-rhel7-9-0-local.x86_64" '
******exec "yum install -y cuda-repo-rhel7-9-0-local.x86_64" 
+ yum install -y cuda-repo-rhel7-9-0-local.x86_64
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Loading mirror speeds from cached hostfile
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.shu.edu.cn
Package cuda-repo-rhel7-9-0-local-9.0.176-1.x86_64 already installed and latest version
Nothing to do
++ date +%s
+ end_cuda_unpack=1536563580
+ time_cuda_unpack=5
+ echo '******download and unpack cuda file end, end time: 1536563580, use time 5 s'
******download and unpack cuda file end, end time: 1536563580, use time 5 s
+ echo '******exec "yum list | grep cuda | grep rhel7 | grep 9.0 | grep update | awk -F'\'' '\'' '\''{print $1}'\''" '
******exec "yum list | grep cuda | grep rhel7 | grep 9.0 | grep update | awk -F' ' '{print $1}'" 
++ yum list
++ grep cuda
++ grep rhel7
++ grep 9.0
++ grep update
++ awk '-F ' '{print $1}'
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
+ cuda_patch_filelist='cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64
cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64'
+ echo '****** cuda_patch_filelist'
****** cuda_patch_filelist
+ echo cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64 cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64
cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64 cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64
+ for cuda_patch_file in '$cuda_patch_filelist'
+ echo '******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64" '
******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64" 
+ yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Loading mirror speeds from cached hostfile
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.shu.edu.cn
Package cuda-repo-rhel7-9-0-local-cublas-performance-update-1.0-1.x86_64 already installed and latest version
Nothing to do
+ for cuda_patch_file in '$cuda_patch_filelist'
+ echo '******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64" '
******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64" 
+ yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Loading mirror speeds from cached hostfile
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.shu.edu.cn
Package cuda-repo-rhel7-9-0-local-cublas-performance-update-2-1.0-1.x86_64 already installed and latest version
Nothing to do
+ echo '******exec "yum clean all && yum install -y cuda" '
******exec "yum clean all && yum install -y cuda" 
+ yum clean all
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Cleaning repos: base cuda-9-0-local cuda-9-0-local-cublas-performance-update
              : cuda-9-0-local-cublas-performance-update-2 ecs-cuda ecs-driver
              : epel extras nvidia-diag-driver-local-390.46 updates
Cleaning up everything
Maybe you want: rm -rf /var/cache/yum, to also free up space taken by orphaned data from disabled or removed repos
Cleaning up list of fastest mirrors
+ yum install -y cuda
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Repository ecs-cuda is listed more than once in the configuration
Repository ecs-driver is listed more than once in the configuration
Determining fastest mirrors
 * base: ftp.sjtu.edu.cn
 * epel: mirrors.myhuaweicloud.com
 * extras: ftp.sjtu.edu.cn
 * updates: mirrors.shu.edu.cn
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/repomd.xml: [Errno -1] repomd.xml does not match metalink for epel
Trying other mirror.
http://mirrors.myhuaweicloud.com/epel/7/x86_64/repodata/64c9816f25be4ae401c3dfa91321604e8864909e134dbd1b0921d077a9a02543-updateinfo.xml.bz2: [Errno 14] HTTP Error 404 - Not Found
Trying other mirror.
To address this issue please refer to the below wiki article 

https://wiki.centos.org/yum-errors

If above article doesn't help to resolve this issue please use https://bugs.centos.org/.

Package cuda-9.0.176-1.x86_64 already installed and latest version
Nothing to do
+ '[' 0 -ne 0 ']'
++ date +%s
+ end_cuda=1536563596
+ time_cuda=21
+ echo '******install cuda begin time: 1536563575, end time 1536563596, use time 21 s'
******install cuda begin time: 1536563575, end time 1536563596, use time 21 s
******install kernel-devel use time 1 s
******install driver use time 18 s
******install cuda use time 21 s
add auto enable Persistence Mode when start vm...
reboot......
