install nvidia driver and cuda begin ......
driver version: 390.46
cuda version: 9.0.176
release:rhel7
version:7
create_nvidia_repo_centos
No package epel available.
Error: Nothing to do
Cleaning repos: EulerOS-base base cuda-9-0-local
              : cuda-9-0-local-cublas-performance-update
              : cuda-9-0-local-cublas-performance-update-2 ecs-cuda ecs-driver
              : ecs-package
Cleaning up everything
Metadata Cache Created
++ uname -r
+ kernel_version=3.10.0-514.44.5.10.h121.x86_64
+ echo '******exec "uname -r": 3.10.0-514.44.5.10.h121.x86_64'
******exec "uname -r": 3.10.0-514.44.5.10.h121.x86_64
+ echo '******exec "rpm -qa | grep kernel-devel | grep 3.10.0-514.44.5.10.h121.x86_64 | wc -l"'
******exec "rpm -qa | grep kernel-devel | grep 3.10.0-514.44.5.10.h121.x86_64 | wc -l"
++ rpm -qa
++ grep kernel-devel
++ grep 3.10.0-514.44.5.10.h121.x86_64
++ wc -l
+ kernel_devel_num=1
+ echo '******kernel_devel_num=1'
******kernel_devel_num=1
+ '[' 1 -eq 0 ']'
******install kernel-devel begin time: 1536634579, end time: 1536634581, use time: 2 s
++ yum list
++ grep driver
++ grep 390.46
++ grep nvidia
++ grep rhel7
++ wc -l
+ driver_file_num=1
+ '[' 1 -eq 1 ']'
++ grep nvidia
++ grep rhel7
++ grep 390.46
++ yum list
++ grep driver
++ awk '-F ' '{print $1}'
+ driver_file=nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
+ echo '******exec "yum list |grep nvidia | grep driver |grep rhel7 |grep 390.46 | awk -F'\'' '\'' '\''{print $1}'\''":'
******exec "yum list |grep nvidia | grep driver |grep rhel7 |grep 390.46 | awk -F' ' '{print $1}'":
+ echo nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
+ echo '******exec "yum install -y nvidia-diag-driver-local-repo-rhel7-390.46.x86_64" '
******exec "yum install -y nvidia-diag-driver-local-repo-rhel7-390.46.x86_64" 
+ yum install -y nvidia-diag-driver-local-repo-rhel7-390.46.x86_64
Resolving Dependencies
There are unfinished transactions remaining. You might consider running yum-complete-transaction, or "yum-complete-transaction --cleanup-only" and "yum history redo last", first to finish them. If those don't work you'll have to try removing/installing packages by hand (maybe package-cleanup can help).
--> Running transaction check
---> Package nvidia-diag-driver-local-repo-rhel7-390.46.x86_64 0:1.0-1 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package                                     Arch    Version  Repository   Size
================================================================================
Installing:
 nvidia-diag-driver-local-repo-rhel7-390.46  x86_64  1.0-1    ecs-driver   87 M

Transaction Summary
================================================================================
Install  1 Package

Total download size: 87 M
Installed size: 89 M
Downloading packages:
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
Warning: RPMDB altered outside of yum.
  Installing : nvidia-diag-driver-local-repo-rhel7-390.46-1.0-1.x86_64      1/1 
  Verifying  : nvidia-diag-driver-local-repo-rhel7-390.46-1.0-1.x86_64      1/1 

Installed:
  nvidia-diag-driver-local-repo-rhel7-390.46.x86_64 0:1.0-1                     

Complete!
+ echo '******exec "yum clean all && yum install -y cuda-drivers" '
******exec "yum clean all && yum install -y cuda-drivers" 
+ yum clean all
Cleaning repos: EulerOS-base base cuda-9-0-local
              : cuda-9-0-local-cublas-performance-update
              : cuda-9-0-local-cublas-performance-update-2 ecs-cuda ecs-driver
              : ecs-package nvidia-diag-driver-local-390.46
Cleaning up everything
+ yum install -y cuda-drivers
Resolving Dependencies
There are unfinished transactions remaining. You might consider running yum-complete-transaction, or "yum-complete-transaction --cleanup-only" and "yum history redo last", first to finish them. If those don't work you'll have to try removing/installing packages by hand (maybe package-cleanup can help).
--> Running transaction check
---> Package cuda-drivers.x86_64 0:390.46-1 will be installed
--> Processing Dependency: xorg-x11-drv-nvidia-libs(x86-64) >= 1:390.46 for package: cuda-drivers-390.46-1.x86_64
--> Processing Dependency: xorg-x11-drv-nvidia-gl(x86-64) >= 1:390.46 for package: cuda-drivers-390.46-1.x86_64
--> Processing Dependency: xorg-x11-drv-nvidia-devel(x86-64) >= 1:390.46 for package: cuda-drivers-390.46-1.x86_64
--> Processing Dependency: xorg-x11-drv-nvidia >= 1:390.46 for package: cuda-drivers-390.46-1.x86_64
--> Processing Dependency: nvidia-kmod >= 1:390.46 for package: cuda-drivers-390.46-1.x86_64
--> Running transaction check
---> Package nvidia-kmod.x86_64 1:384.81-2.el7 will be updated
---> Package nvidia-kmod.x86_64 1:390.46-2.el7 will be an update
---> Package xorg-x11-drv-nvidia.x86_64 1:390.46-1.el7 will be installed
---> Package xorg-x11-drv-nvidia-devel.x86_64 1:390.46-1.el7 will be installed
---> Package xorg-x11-drv-nvidia-gl.x86_64 1:390.46-1.el7 will be installed
---> Package xorg-x11-drv-nvidia-libs.x86_64 1:390.46-1.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package            Arch   Version        Repository                       Size
================================================================================
Installing:
 cuda-drivers       x86_64 390.46-1       nvidia-diag-driver-local-390.46 2.9 k
Installing for dependencies:
 xorg-x11-drv-nvidia
                    x86_64 1:390.46-1.el7 nvidia-diag-driver-local-390.46 4.7 M
 xorg-x11-drv-nvidia-devel
                    x86_64 1:390.46-1.el7 nvidia-diag-driver-local-390.46 121 k
 xorg-x11-drv-nvidia-gl
                    x86_64 1:390.46-1.el7 nvidia-diag-driver-local-390.46  21 M
 xorg-x11-drv-nvidia-libs
                    x86_64 1:390.46-1.el7 nvidia-diag-driver-local-390.46  33 M
Updating for dependencies:
 nvidia-kmod        x86_64 1:390.46-2.el7 nvidia-diag-driver-local-390.46 9.6 M

Transaction Summary
================================================================================
Install  1 Package  (+4 Dependent packages)
Upgrade             ( 1 Dependent package)

Total download size: 68 M
Downloading packages:
--------------------------------------------------------------------------------
Total                                              616 MB/s |  68 MB  00:00     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Updating   : 1:nvidia-kmod-390.46-2.el7.x86_64                            1/7 

Creating symlink /var/lib/dkms/nvidia/390.46/source ->
                 /usr/src/nvidia-390.46

DKMS: add completed.

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
cleaning build area...
'make' -j8 NV_EXCLUDE_BUILD_MODULES='' KERNEL_UNAME=3.10.0-514.44.5.10.h121.x86_64 modules.........................
cleaning build area...

DKMS: build completed.

nvidia.ko:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/3.10.0-514.44.5.10.h121.x86_64/kernel/drivers/video/

nvidia-uvm.ko:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/3.10.0-514.44.5.10.h121.x86_64/kernel/drivers/video/

nvidia-modeset.ko:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/3.10.0-514.44.5.10.h121.x86_64/kernel/drivers/video/

nvidia-drm.ko:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/3.10.0-514.44.5.10.h121.x86_64/kernel/drivers/video/
Adding any weak-modules

depmod...

DKMS: install completed.
  Installing : 1:xorg-x11-drv-nvidia-390.46-1.el7.x86_64                    2/7 
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-514.44.5.10.h121.x86_64
Found initrd image: /boot/initramfs-3.10.0-514.44.5.10.h121.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-a2b77d8927c24b86a3d593d1a059c23a
Found initrd image: /boot/initramfs-0-rescue-a2b77d8927c24b86a3d593d1a059c23a.img
Found linux image: /boot/vmlinuz-3.10.0-514.44.5.10.h121.x86_64
Found initrd image: /boot/initramfs-3.10.0-514.44.5.10.h121.x86_64.img
done
  Installing : 1:xorg-x11-drv-nvidia-libs-390.46-1.el7.x86_64               3/7 
  Installing : 1:xorg-x11-drv-nvidia-gl-390.46-1.el7.x86_64                 4/7 
  Installing : 1:xorg-x11-drv-nvidia-devel-390.46-1.el7.x86_64              5/7 
  Installing : cuda-drivers-390.46-1.x86_64                                 6/7 

------------------------------
Deleting module version: 384.81
completely from the DKMS tree.
------------------------------
Done.
  Cleanup    : 1:nvidia-kmod-384.81-2.el7.x86_64                            7/7 
  Verifying  : 1:xorg-x11-drv-nvidia-gl-390.46-1.el7.x86_64                 1/7 
  Verifying  : 1:xorg-x11-drv-nvidia-libs-390.46-1.el7.x86_64               2/7 
  Verifying  : cuda-drivers-390.46-1.x86_64                                 3/7 
  Verifying  : 1:xorg-x11-drv-nvidia-390.46-1.el7.x86_64                    4/7 
  Verifying  : 1:xorg-x11-drv-nvidia-devel-390.46-1.el7.x86_64              5/7 
  Verifying  : 1:nvidia-kmod-390.46-2.el7.x86_64                            6/7 
  Verifying  : 1:nvidia-kmod-384.81-2.el7.x86_64                            7/7 

Installed:
  cuda-drivers.x86_64 0:390.46-1                                                

Dependency Installed:
  xorg-x11-drv-nvidia.x86_64 1:390.46-1.el7                                     
  xorg-x11-drv-nvidia-devel.x86_64 1:390.46-1.el7                               
  xorg-x11-drv-nvidia-gl.x86_64 1:390.46-1.el7                                  
  xorg-x11-drv-nvidia-libs.x86_64 1:390.46-1.el7                                

Dependency Updated:
  nvidia-kmod.x86_64 1:390.46-2.el7                                             

Complete!
+ '[' 0 -ne 0 ']'
******install driver begin time: 1536634581, end time: 1536634809,  use time: 228 s
++ date +%s
+ begin_cuda=1536634809
++ yum list
++ grep cuda
++ grep 9.0.176
++ wc -l
++ grep rhel7
++ grep -v update
+ cuda_file_num=1
+ '[' 1 -eq 1 ']'
++ yum list
++ grep cuda
++ grep 9.0.176
++ awk '-F ' '{print $1}'
++ grep rhel7
++ grep -v update
+ cuda_file=cuda-repo-rhel7-9-0-local.x86_64
+ echo '******exec "yum list --showduplicates |grep cuda |grep rhel7 |grep 9.0.176|grep -v update| awk -F'\'' '\'' '\''{print $1}'\''":'
******exec "yum list --showduplicates |grep cuda |grep rhel7 |grep 9.0.176|grep -v update| awk -F' ' '{print $1}'":
+ echo cuda-repo-rhel7-9-0-local.x86_64
cuda-repo-rhel7-9-0-local.x86_64
+ echo '******exec "yum install -y cuda-repo-rhel7-9-0-local.x86_64" '
******exec "yum install -y cuda-repo-rhel7-9-0-local.x86_64" 
+ yum install -y cuda-repo-rhel7-9-0-local.x86_64
Package cuda-repo-rhel7-9-0-local-9.0.176-1.x86_64 already installed and latest version
Nothing to do
++ date +%s
+ end_cuda_unpack=1536634811
+ time_cuda_unpack=2
+ echo '******download and unpack cuda file end, end time: 1536634811, use time 2 s'
******download and unpack cuda file end, end time: 1536634811, use time 2 s
+ echo '******exec "yum list | grep cuda | grep rhel7 | grep 9.0 | grep update | awk -F'\'' '\'' '\''{print $1}'\''" '
******exec "yum list | grep cuda | grep rhel7 | grep 9.0 | grep update | awk -F' ' '{print $1}'" 
++ yum list
++ grep rhel7
++ grep cuda
++ grep 9.0
++ awk '-F ' '{print $1}'
++ grep update
+ cuda_patch_filelist='cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64
cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64'
+ echo '****** cuda_patch_filelist'
****** cuda_patch_filelist
+ echo cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64 cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64
cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64 cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64
+ for cuda_patch_file in '$cuda_patch_filelist'
+ echo '******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64" '
******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64" 
+ yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update.x86_64
Package cuda-repo-rhel7-9-0-local-cublas-performance-update-1.0-1.x86_64 already installed and latest version
Nothing to do
+ for cuda_patch_file in '$cuda_patch_filelist'
+ echo '******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64" '
******exec "yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64" 
+ yum install -y cuda-repo-rhel7-9-0-local-cublas-performance-update-2.x86_64
Package cuda-repo-rhel7-9-0-local-cublas-performance-update-2-1.0-1.x86_64 already installed and latest version
Nothing to do
+ echo '******exec "yum clean all && yum install -y cuda" '
******exec "yum clean all && yum install -y cuda" 
+ yum clean all
Cleaning repos: EulerOS-base base cuda-9-0-local
              : cuda-9-0-local-cublas-performance-update
              : cuda-9-0-local-cublas-performance-update-2 ecs-cuda ecs-driver
              : ecs-package nvidia-diag-driver-local-390.46
Cleaning up everything
+ yum install -y cuda
Resolving Dependencies
There are unfinished transactions remaining. You might consider running yum-complete-transaction, or "yum-complete-transaction --cleanup-only" and "yum history redo last", first to finish them. If those don't work you'll have to try removing/installing packages by hand (maybe package-cleanup can help).
--> Running transaction check
---> Package cuda.x86_64 0:9.0.176-1 will be installed
--> Processing Dependency: cuda-9-0 >= 9.0.176 for package: cuda-9.0.176-1.x86_64
--> Running transaction check
---> Package cuda-9-0.x86_64 0:9.0.176-1 will be installed
--> Processing Dependency: cuda-runtime-9-0 >= 9.0.176 for package: cuda-9-0-9.0.176-1.x86_64
--> Processing Dependency: cuda-demo-suite-9-0 >= 9.0.176 for package: cuda-9-0-9.0.176-1.x86_64
--> Running transaction check
---> Package cuda-demo-suite-9-0.x86_64 0:9.0.176-1 will be installed
---> Package cuda-runtime-9-0.x86_64 0:9.0.176-1 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package                  Arch        Version         Repository           Size
================================================================================
Installing:
 cuda                     x86_64      9.0.176-1       cuda-9-0-local      5.8 k
Installing for dependencies:
 cuda-9-0                 x86_64      9.0.176-1       cuda-9-0-local      5.9 k
 cuda-demo-suite-9-0      x86_64      9.0.176-1       cuda-9-0-local      4.7 M
 cuda-runtime-9-0         x86_64      9.0.176-1       cuda-9-0-local      5.9 k

Transaction Summary
================================================================================
Install  1 Package (+3 Dependent packages)

Total download size: 4.8 M
Installed size: 11 M
Downloading packages:
--------------------------------------------------------------------------------
Total                                              176 MB/s | 4.8 MB  00:00     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : cuda-runtime-9-0-9.0.176-1.x86_64                            1/4 
  Installing : cuda-demo-suite-9-0-9.0.176-1.x86_64                         2/4 
  Installing : cuda-9-0-9.0.176-1.x86_64                                    3/4 
  Installing : cuda-9.0.176-1.x86_64                                        4/4 
  Verifying  : cuda-9.0.176-1.x86_64                                        1/4 
  Verifying  : cuda-9-0-9.0.176-1.x86_64                                    2/4 
  Verifying  : cuda-runtime-9-0-9.0.176-1.x86_64                            3/4 
  Verifying  : cuda-demo-suite-9-0-9.0.176-1.x86_64                         4/4 

Installed:
  cuda.x86_64 0:9.0.176-1                                                       

Dependency Installed:
  cuda-9-0.x86_64 0:9.0.176-1           cuda-demo-suite-9-0.x86_64 0:9.0.176-1  
  cuda-runtime-9-0.x86_64 0:9.0.176-1  

Complete!
+ '[' 0 -ne 0 ']'
++ date +%s
+ end_cuda=1536634825
+ time_cuda=16
+ echo '******install cuda begin time: 1536634809, end time 1536634825, use time 16 s'
******install cuda begin time: 1536634809, end time 1536634825, use time 16 s
******install kernel-devel use time 2 s
******install driver use time 228 s
******install cuda use time 16 s
add auto enable Persistence Mode when start vm...
reboot......
